#!/usr/bin/env bash
set -euo pipefail
if [[ "${1:-}" == "--check" ]]; then
  if command -v speedometer >/dev/null 2>&1; then
    exit 0
  fi
  command -v bmon >/dev/null 2>&1
  exit $?
fi
if command -v speedometer >/dev/null 2>&1; then
  while true; do
    iface="$(ip route 2>/dev/null | awk '/default/ {print $5; exit}')"
    [[ -n "$iface" ]] || { sleep 1; continue; }
    speedometer -tx "$iface" -rx "$iface" -i 0.75
    sleep 1
  done
else
  exec bmon --show-all
fi
